<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Happy New Year ðŸŽ†</title>
<style>
  :root{
    --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
    --card: rgba(255,255,255,.08);
    --stroke: rgba(255,255,255,.14);
    --txt: rgba(255,255,255,.94);
    --muted: rgba(255,255,255,.74);
    --gold:#ffd36a; --pink:#ff5fd7; --cyan:#50e3ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100svh;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
    color:#fff;
    padding: env(safe-area-inset-top) 14px env(safe-area-inset-bottom);
    background:
      radial-gradient(900px 650px at 20% 10%, rgba(80,227,255,.14), transparent 55%),
      radial-gradient(820px 600px at 90% 20%, rgba(255,95,215,.12), transparent 55%),
      linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
  }

  /* reduce heavy blur cost a bit */
  .orb{
    position:absolute; width:360px; height:360px; border-radius:50%;
    filter: blur(28px); opacity:.16; mix-blend-mode: screen;
    animation: float 12s ease-in-out infinite;
    pointer-events:none;
  }
  .orb.one{background: radial-gradient(circle at 30% 30%, var(--cyan), transparent 60%); left:-140px; top:40px;}
  .orb.two{background: radial-gradient(circle at 30% 30%, var(--pink), transparent 60%); right:-160px; top:120px; animation-delay:-3s;}
  .orb.three{background: radial-gradient(circle at 30% 30%, var(--gold), transparent 60%); left:22%; bottom:-200px; animation-delay:-6s;}
  @keyframes float{0%,100%{transform:translate3d(0,0,0) scale(1)}50%{transform:translate3d(25px,-18px,0) scale(1.04)}}

  .stars{
    position:absolute; inset:0; pointer-events:none; opacity:.75;
    background:
      radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,.72), transparent 60%),
      radial-gradient(1.5px 1.5px at 28% 66%, rgba(255,255,255,.5), transparent 60%),
      radial-gradient(2.2px 2.2px at 74% 28%, rgba(255,255,255,.6), transparent 60%),
      radial-gradient(1.4px 1.4px at 84% 62%, rgba(255,255,255,.48), transparent 60%);
    animation: twinkle 4.4s ease-in-out infinite;
  }
  @keyframes twinkle{0%,100%{opacity:.55}50%{opacity:.85}}

  .card{
    position:relative;
    width:min(560px, 96vw);
    text-align:center;
    padding:28px 20px 22px;
    border-radius:18px;
    background: var(--card);
    backdrop-filter: blur(9px);
    box-shadow: 0 20px 46px rgba(0,0,0,.45);
    border:1px solid var(--stroke);
    opacity:0;
    transform: translateY(14px) scale(.985);
    animation: cardIn .9s cubic-bezier(.2,.9,.2,1) forwards;
  }
  @keyframes cardIn{to{opacity:1; transform:translateY(0) scale(1)}}

  h1{
    margin:0 0 10px;
    font-size: clamp(22px, 4.4vw, 34px);
    opacity:0; transform: translateY(-12px);
    animation: titleDrop .75s ease forwards .12s;
    text-shadow: 0 0 14px rgba(255,211,106,.18);
  }
  @keyframes titleDrop{to{opacity:1; transform:translateY(0)}}

  .stepTag{
    margin: 0 0 8px;
    font-size:.9rem;
    color: rgba(255,255,255,.82);
    opacity:0; transform: translateY(6px);
    animation: fadeUp .6s ease forwards .25s;
  }
  @keyframes fadeUp{to{opacity:1; transform:translateY(0)}}

  .question{
    margin: 10px 0 10px;
    font-size: clamp(18px, 5vw, 24px);
    line-height: 1.45;
    color: var(--txt);
    opacity:0;
    transform: translateY(8px);
  }
  .question.pop{ animation: qPop .45s cubic-bezier(.2,1.15,.25,1) forwards; }
  @keyframes qPop{
    0%{opacity:0; transform: translateY(8px) scale(.99)}
    100%{opacity:1; transform: translateY(0) scale(1)}
  }

  .subline{
    margin: 0 0 14px;
    color: var(--muted);
    font-size: .98rem;
    min-height: 22px;
    opacity:0;
    transform: translateY(6px);
  }
  .subline.show{ animation: fadeUp .45s ease forwards; }

  .btnRow{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    margin-top: 10px;
  }
  button{
    border:none;
    cursor:pointer;
    padding: 14px 14px;
    border-radius: 999px;
    font-weight: 800;
    transition: transform .12s ease;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
    min-height: 48px;
  }
  .btnPrimary{
    color:#091018;
    background: linear-gradient(135deg, var(--gold), #fff);
  }
  .btnGhost{
    color:#fff;
    background: rgba(255,255,255,.12);
    border:1px solid rgba(255,255,255,.18);
  }
  button:active{transform: translateY(1px) scale(.99)}

  @media (max-width: 420px){
    .card{padding: 24px 16px 18px; border-radius:16px;}
    .btnRow{grid-template-columns: 1fr;}
  }

  .overlay{
    position:absolute; inset:0;
    pointer-events:none;
    opacity:0;
    transition: opacity .2s ease;
  }
  .overlay.on{opacity:1}
  canvas{position:absolute; inset:0; width:100%; height:100%; pointer-events:none}

  .big{
    position:absolute; left:50%; top:50%;
    transform: translate(-50%,-50%) scale(.92);
    text-align:center;
    opacity:0;
    width:min(900px, 94vw);
    padding: 18px 14px;
  }
  .big.on{opacity:1; animation: bigPop .9s ease forwards;}
  @keyframes bigPop{
    from{transform:translate(-50%,-50%) scale(.82)}
    to{transform:translate(-50%,-50%) scale(1)}
  }
  .big h2{
    margin:0;
    font-size: clamp(34px, 9vw, 72px);
    line-height:1.05;
    text-shadow: 0 0 18px rgba(80,227,255,.12);
  }
  .big p{ margin:10px 0 0; font-size: clamp(14px, 4vw, 18px); opacity:.9; }

  .balloons{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
  .balloon{
    position:absolute;
    width:42px; height:54px;
    border-radius: 50% 50% 48% 48%;
    opacity:.82;
    transform: translateY(110vh);
    animation: rise 7.8s linear infinite;
  }
  .balloon::after{
    content:""; position:absolute; left:50%; top: 52px;
    width:2px; height:56px; background: rgba(255,255,255,.35);
    transform: translateX(-50%);
  }
  @keyframes rise{
    0%{transform: translateY(110vh) translateX(0)}
    100%{transform: translateY(-140px) translateX(24px)}
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce){
    .orb,.stars,.card,.question,.big{animation:none!important}
  }
</style>
</head>
<body>
  <div class="orb one"></div>
  <div class="orb two"></div>
  <div class="orb three"></div>
  <div class="stars"></div>

  <div class="card" role="region" aria-label="New Year flow">
    <h1>âœ¨ Happy New Year âœ¨</h1>
    <div class="stepTag" id="stepTag">Step 1/4</div>

    <div class="question pop" id="question"></div>
    <div class="subline" id="subline"></div>

    <div class="btnRow" id="btnRow"></div>
  </div>

  <div class="overlay" id="overlay">
    <canvas id="fireworks"></canvas>
    <canvas id="confetti"></canvas>
    <div class="balloons" id="balloons"></div>

    <div class="big" id="big">
      <h2>ðŸŽ† HAPPY NEW YEAR ðŸŽ†</h2>
      <p>Party mode ON ðŸ¥³ðŸŽˆðŸš€</p>
      <p style="opacity:.72; margin-top:8px;">(Press ESC to stop)</p>
    </div>
  </div>

<script>
/* =======================
   PERFORMANCE OPTIMIZATIONS
   - Cap DPR for old phones
   - Run animations ~30fps (throttled RAF)
   - Limit particle counts based on device
======================= */

const stepTag = document.getElementById("stepTag");
const questionEl = document.getElementById("question");
const sublineEl = document.getElementById("subline");
const btnRow = document.getElementById("btnRow");

const overlay = document.getElementById("overlay");
const big = document.getElementById("big");
const balloonsWrap = document.getElementById("balloons");

const fwCanvas = document.getElementById("fireworks");
const cfCanvas = document.getElementById("confetti");
const fwCtx = fwCanvas.getContext("2d", { alpha: true });
const cfCtx = cfCanvas.getContext("2d", { alpha: true });

let celebrating = false;
let burstTimer = null;
let balloonTimer = null;
const noRetry = { 1:0, 2:0, 3:0, 4:0 };

// --- Device heuristics (simple) ---
const isLowEnd =
  (navigator.deviceMemory && navigator.deviceMemory <= 2) ||
  (navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 4) ||
  /Android\s(6|7|8|9)|iPhone\s(6|7|8)/i.test(navigator.userAgent);

const MAX_DPR = isLowEnd ? 1.25 : 1.6;      // cap canvas resolution
const TARGET_FPS = isLowEnd ? 28 : 40;      // smoother on old phones
const FRAME_MS = 1000 / TARGET_FPS;

// particle limits
const LIMITS = {
  sparksMax: isLowEnd ? 520 : 900,
  rocketsMax: isLowEnd ? 3 : 6,
  confettiMax: isLowEnd ? 260 : 520,
  burstSparks: isLowEnd ? 55 : 90,
  confettiSpawn: isLowEnd ? 120 : 220,
  confettiExtra: isLowEnd ? 24 : 60,
};

// ---- SOUND (keep minimal on old phones) ----
let audioCtx;
function ensureAudio(){
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === "suspended") audioCtx.resume();
}
function popSound(timeOffset=0){
  ensureAudio();
  const t0 = audioCtx.currentTime + timeOffset;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "triangle";
  o.frequency.setValueAtTime(170, t0);
  o.frequency.exponentialRampToValueAtTime(520, t0 + 0.03);
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(isLowEnd ? 0.16 : 0.22, t0 + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.12);
  o.connect(g).connect(audioCtx.destination);
  o.start(t0); o.stop(t0 + 0.14);
}
function crackleNoise(duration=0.18, timeOffset=0){
  ensureAudio();
  const t0 = audioCtx.currentTime + timeOffset;
  const bufferSize = Math.max(1, Math.floor(audioCtx.sampleRate * duration));
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i=0;i<bufferSize;i++){
    data[i] = (Math.random()*2 - 1) * (Math.random() < 0.05 ? 1 : 0.16);
  }
  const src = audioCtx.createBufferSource(); src.buffer = buffer;
  const g = audioCtx.createGain();
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(isLowEnd ? 0.18 : 0.24, t0 + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + duration);
  const f = audioCtx.createBiquadFilter();
  f.type = "highpass"; f.frequency.value = 750;
  src.connect(f).connect(g).connect(audioCtx.destination);
  src.start(t0); src.stop(t0 + duration);
}
function happyNewYearJingle(){
  ensureAudio();
  const now = audioCtx.currentTime;
  const notes = [523.25, 659.25, 783.99];
  notes.forEach((freq, i) => {
    const t0 = now + i*0.12;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "sine";
    o.frequency.setValueAtTime(freq, t0);
    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(isLowEnd ? 0.14 : 0.18, t0 + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.18);
    o.connect(g).connect(audioCtx.destination);
    o.start(t0); o.stop(t0 + 0.22);
  });
}
function celebrationSoundBurst(){
  happyNewYearJingle();
  popSound(0.10); crackleNoise(0.16, 0.12);
  popSound(0.28); crackleNoise(0.16, 0.30);
  if (!isLowEnd){ popSound(0.46); crackleNoise(0.18, 0.48); }
}

// ---- CANVAS RESIZE (capped DPR) ----
function resize(){
  const dprRaw = devicePixelRatio || 1;
  const dpr = Math.min(dprRaw, MAX_DPR);
  fwCanvas.width = cfCanvas.width = Math.floor(window.innerWidth * dpr);
  fwCanvas.height = cfCanvas.height = Math.floor(window.innerHeight * dpr);
  fwCtx.setTransform(dpr,0,0,dpr,0,0);
  cfCtx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resize, { passive:true });
resize();

// ---- Fireworks / rockets ----
const sparks = [];
const rockets = [];

function burst(x, y){
  const count = LIMITS.burstSparks;
  const hueBase = Math.random()*360;

  // avoid unlimited growth
  if (sparks.length > LIMITS.sparksMax) sparks.splice(0, sparks.length - LIMITS.sparksMax);

  for (let i=0;i<count;i++){
    const a = (Math.PI*2) * (i / count);
    const speed = 2.0 + Math.random()*3.8;
    sparks.push({
      x,y,
      vx: Math.cos(a)*speed*(0.65+Math.random()*0.55),
      vy: Math.sin(a)*speed*(0.65+Math.random()*0.55),
      life: 1,
      decay: 0.016 + Math.random()*0.018,
      size: 1 + Math.random()*1.6,
      hue: (hueBase + (Math.random()*50 - 25)) % 360
    });
  }
}

function launchRocket(){
  if (rockets.length >= LIMITS.rocketsMax) return;
  const x = 80 + Math.random()*(window.innerWidth-160);
  const y = window.innerHeight + 30;
  rockets.push({
    x, y,
    vx: (Math.random()*2 - 1) * 0.45,
    vy: -(5.8 + Math.random()*2.8),
    hue: Math.random()*360,
    trail: [],
    explodeAt: 140 + Math.random()*(window.innerHeight*0.33)
  });
}

// RAF throttling
let lastFW = 0;
function fireworksLoop(ts){
  if (!celebrating) return;
  if (ts - lastFW < FRAME_MS) { requestAnimationFrame(fireworksLoop); return; }
  lastFW = ts;

  fwCtx.fillStyle = "rgba(0,0,0,0.22)";
  fwCtx.fillRect(0,0,window.innerWidth,window.innerHeight);

  fwCtx.globalCompositeOperation = "lighter";

  for (let i=rockets.length-1;i>=0;i--){
    const r = rockets[i];
    r.x += r.vx; r.y += r.vy;
    r.vy *= 0.996;

    r.trail.push({x:r.x, y:r.y});
    if (r.trail.length > (isLowEnd ? 10 : 14)) r.trail.shift();

    for (let t=0;t<r.trail.length;t++){
      const p = r.trail[t];
      fwCtx.fillStyle = `hsla(${r.hue}, 100%, 65%, ${t/r.trail.length})`;
      fwCtx.fillRect(p.x, p.y, 2, 2);
    }

    fwCtx.fillStyle = `hsla(${r.hue}, 100%, 70%, 1)`;
    fwCtx.beginPath();
    fwCtx.arc(r.x, r.y, 2.2, 0, Math.PI*2);
    fwCtx.fill();

    if (r.y < r.explodeAt){
      burst(r.x, r.y);
      popSound(0);
      if (Math.random()<0.45) crackleNoise(0.16, 0);
      rockets.splice(i,1);
    }
  }

  for (let i=sparks.length-1;i>=0;i--){
    const s = sparks[i];
    s.x += s.vx; s.y += s.vy;
    s.vy += 0.03;          // gravity
    s.vx *= 0.992; s.vy *= 0.992;
    s.life -= s.decay;

    const a = s.life;
    if (a <= 0){ sparks.splice(i,1); continue; }

    fwCtx.fillStyle = `hsla(${s.hue}, 100%, 65%, ${a})`;
    fwCtx.beginPath();
    fwCtx.arc(s.x, s.y, s.size, 0, Math.PI*2);
    fwCtx.fill();
  }

  fwCtx.globalCompositeOperation = "source-over";
  requestAnimationFrame(fireworksLoop);
}

// ---- Confetti ----
const confetti = [];
function spawnConfetti(amount){
  const target = Math.min(amount, LIMITS.confettiMax - confetti.length);
  for (let i=0;i<target;i++){
    confetti.push({
      x: Math.random()*window.innerWidth,
      y: -20 - Math.random()*window.innerHeight*0.15,
      vx: (Math.random()*2 - 1) * 0.95,
      vy: 1.7 + Math.random()*2.6,
      w: 5 + Math.random()*7,
      h: 6 + Math.random()*8,
      rot: Math.random()*Math.PI*2,
      vr: (Math.random()*2 - 1) * 0.06,
      life: 1,
      decay: 0.004 + Math.random()*0.004,
      hue: Math.random()*360
    });
  }
}

let lastCF = 0;
function confettiLoop(ts){
  if (!celebrating) return;
  if (ts - lastCF < FRAME_MS) { requestAnimationFrame(confettiLoop); return; }
  lastCF = ts;

  cfCtx.clearRect(0,0,window.innerWidth,window.innerHeight);

  for (let i=confetti.length-1;i>=0;i--){
    const c = confetti[i];
    c.x += c.vx; c.y += c.vy;
    c.rot += c.vr;
    c.vx *= 0.995; c.vy *= 0.998;
    c.life -= c.decay;

    if (c.life <= 0 || c.y > window.innerHeight+70){ confetti.splice(i,1); continue; }

    cfCtx.save();
    cfCtx.translate(c.x, c.y);
    cfCtx.rotate(c.rot);
    cfCtx.fillStyle = `hsla(${c.hue}, 95%, 60%, ${c.life})`;
    cfCtx.fillRect(-c.w/2, -c.h/2, c.w, c.h);
    cfCtx.restore();
  }

  requestAnimationFrame(confettiLoop);
}

// ---- Balloons ----
function spawnBalloon(){
  const b = document.createElement("div");
  b.className = "balloon";
  b.style.left = (Math.random()*(window.innerWidth-60)) + "px";
  const hue = Math.floor(Math.random()*360);
  b.style.background = `radial-gradient(circle at 30% 30%, hsla(${hue},100%,70%,.95), hsla(${hue},100%,45%,.9))`;
  b.style.animationDuration = (isLowEnd ? 8.5 : 7.5) + "s";
  balloonsWrap.appendChild(b);
  setTimeout(()=>b.remove(), 11000);
}
function startBalloons(){
  spawnBalloon();
  balloonTimer = setInterval(spawnBalloon, isLowEnd ? 750 : 560);
}
function stopBalloons(){
  if (balloonTimer) clearInterval(balloonTimer);
  balloonTimer = null;
  balloonsWrap.innerHTML = "";
}

// ---- UI helpers ----
function setQuestion(stepNum, qText, buttons){
  stepTag.textContent = `Step ${stepNum}/4`;
  questionEl.classList.remove("pop");
  sublineEl.classList.remove("show");
  void questionEl.offsetWidth;
  questionEl.textContent = qText;
  questionEl.classList.add("pop");

  btnRow.innerHTML = "";
  buttons.forEach(b=>{
    const btn = document.createElement("button");
    btn.textContent = b.label;
    btn.className = b.primary ? "btnPrimary" : "btnGhost";
    btn.addEventListener("click", () => {
      try{ popSound(0); }catch(e){}
      b.onClick();
    }, { passive:true });
    btnRow.appendChild(btn);
  });
}

function showSubline(text, waitMs=750){
  sublineEl.textContent = text;
  sublineEl.classList.add("show");
  return new Promise(res => setTimeout(res, waitMs));
}

function renderStep(n){
  if (n === 1) goStep1();
  if (n === 2) goStep2();
  if (n === 3) goStep3();
  if (n === 4) goStep4();
}

async function handleNo(stepNum, retryMsg, afterSecondNo){
  if (noRetry[stepNum] === 0){
    noRetry[stepNum] = 1;
    await showSubline("Ek baar aur? ðŸ˜„", 600);
    renderStep(stepNum);
  } else {
    noRetry[stepNum] = 0;
    if (retryMsg) await showSubline(retryMsg, 750);
    afterSecondNo();
  }
}

// ---- Steps (same logic) ----
function goStep1(){
  setQuestion(1, "Sound high hai? ðŸ”Š", [
    { label:"HAAN", primary:true, onClick: () => { ensureAudio(); noRetry[1]=0; goStep2(); } },
    { label:"NAHI", primary:false, onClick: () => handleNo(1, "Kar na phir ðŸ˜ðŸ”Š", () => goStep2()) }
  ]);
}
function goStep2(){
  setQuestion(2, "Kuch bhool raha hai? ðŸ¤”", [
    { label:"HAAN", primary:true, onClick: () => { noRetry[2]=0; goStep3(); } },
    { label:"NAHI", primary:false, onClick: () => handleNo(2, "Yaad karo phir ðŸ˜‚ðŸ§ ", () => goStep3()) }
  ]);
}
function goStep3(){
  setQuestion(3, "Hume bhool gaya kya? ðŸ˜’", [
    { label:"HAAN", primary:true, onClick: () => { noRetry[3]=0; goStep4(); } },
    { label:"NAHI", primary:false, onClick: () => handleNo(3, "Phir se start kar ðŸ˜œðŸ”", () => goStep1()) }
  ]);
}
function goStep4(){
  setQuestion(4, "Okâ€¦ ready for party? ðŸ¥³", [
    { label:"PARTY", primary:true, onClick: () => { noRetry[4]=0; startCelebration(); } },
    { label:"NAHI", primary:false, onClick: () => handleNo(4, "Chal na yaar ðŸ˜ðŸ»", () => renderStep(4)) }
  ]);
}

// ---- Celebration ----
function startCelebration(){
  if (celebrating) return;
  celebrating = true;

  overlay.classList.add("on");
  big.classList.add("on");
  overlay.style.pointerEvents = "auto";

  celebrationSoundBurst();

  fwCtx.clearRect(0,0,window.innerWidth,window.innerHeight);
  cfCtx.clearRect(0,0,window.innerWidth,window.innerHeight);

  spawnConfetti(LIMITS.confettiSpawn);
  startBalloons();

  // initial bursts
  const cx = window.innerWidth/2;
  const cy = window.innerHeight/2;
  burst(cx, cy - 80);
  if (!isLowEnd){ burst(cx - 150, cy - 30); burst(cx + 150, cy - 30); }

  // few rockets
  for (let i=0;i<(isLowEnd ? 2 : 5);i++) launchRocket();

  // start loops (throttled)
  requestAnimationFrame(fireworksLoop);
  requestAnimationFrame(confettiLoop);

  // keep firing but lighter
  burstTimer = setInterval(() => {
    if (!celebrating) return;
    if (Math.random() < (isLowEnd ? 0.55 : 0.7)) launchRocket();
    if (Math.random() < (isLowEnd ? 0.20 : 0.35)) crackleNoise(0.16, 0);
    if (Math.random() < (isLowEnd ? 0.18 : 0.30)) spawnConfetti(LIMITS.confettiExtra);
  }, isLowEnd ? 900 : 700);

  overlay.addEventListener("click", overlayClickBurst, { passive:true });
}

function overlayClickBurst(e){
  if (!celebrating) return;
  burst(e.clientX, e.clientY);
  popSound(0);
  if (!isLowEnd && Math.random()<0.55) crackleNoise(0.16,0);
}

function stopCelebration(){
  celebrating = false;
  overlay.classList.remove("on");
  big.classList.remove("on");
  overlay.style.pointerEvents = "none";

  if (burstTimer) clearInterval(burstTimer);
  burstTimer = null;

  stopBalloons();
  sparks.length = 0;
  rockets.length = 0;
  confetti.length = 0;

  fwCtx.clearRect(0,0,window.innerWidth,window.innerHeight);
  cfCtx.clearRect(0,0,window.innerWidth,window.innerHeight);

  overlay.removeEventListener("click", overlayClickBurst);
}

window.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && celebrating) stopCelebration();
});

// Init
goStep1();
</script>
</body>
</html>
